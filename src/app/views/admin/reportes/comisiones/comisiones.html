<app-alert 
  [isOpen]="isAlertModalOpen"
  [type]="alertType"
  [message]="alertMessage"
  (closed)="closeAlertModal()">
</app-alert>
<div class="space-y-6">

    <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700">
        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
            <fa-icon [icon]="faCalendarDays" class="mr-3 text-blue-500"></fa-icon>
            Filtro por Período
        </h3>

        <form (ngSubmit)="loadCommissionReports()" class="grid grid-cols-1 sm:grid-cols-3 gap-4 items-end">
            <div>
                <label for="startDate" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Desde:</label>
                <input type="date" id="startDate" name="startDate" [(ngModel)]="filterData.startDate"
                    class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:ring-blue-500 focus:border-blue-500" required>
            </div>
            
            <div>
                <label for="endDate" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Hasta:</label>
                <input type="date" id="endDate" name="endDate" [(ngModel)]="filterData.endDate"
                    class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white focus:ring-blue-500 focus:border-blue-500" required>
            </div>

            <button type="submit" [disabled]="isLoading"
                class="flex items-center justify-center h-10 px-4 py-2 text-sm font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 transition-colors shadow-md disabled:bg-blue-400">
                <fa-icon [icon]="faSearch" class="mr-2"></fa-icon> 
                {{ isLoading ? 'Buscando...' : 'Generar Reporte' }}
            </button>
        </form>
    </div>

    @if (hasSearched && !isLoading) {
        <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg shadow-inner flex justify-between items-center">
            <h4 class="text-gray-700 dark:text-gray-300 text-lg font-medium">
                Resultados encontrados: <span class="font-bold text-blue-600 dark:text-blue-400">{{ reports.length }}</span>
            </h4>
            
            <div class="flex gap-3">
                <button (click)="exportToExcel()" class="flex items-center px-3 py-1.5 text-sm font-medium rounded-lg text-white bg-green-600 hover:bg-green-700 transition-colors shadow-sm">
                    <fa-icon [icon]="faFileExport" class="mr-2"></fa-icon> Excel
                </button>
                <button (click)="exportToPdf()" class="flex items-center px-3 py-1.5 text-sm font-medium rounded-lg text-white bg-red-600 hover:bg-red-700 transition-colors shadow-sm">
                    <fa-icon [icon]="faFileExport" class="mr-2"></fa-icon> PDF
                </button>
                <button (click)="exportToImage()" class="flex items-center px-3 py-1.5 text-sm font-medium rounded-lg text-white bg-yellow-600 hover:bg-yellow-700 transition-colors shadow-sm">
                    <fa-icon [icon]="faFileExport" class="mr-2"></fa-icon> Imagen
                </button>
            </div>
        </div>
    }

    @if (isLoading) {
        <div class="text-center py-10 text-gray-500 dark:text-gray-400">Cargando datos de comisiones...</div>
    } @else if (hasSearched && reports.length === 0) {
        <div class="text-center py-10 text-gray-500 dark:text-gray-400 border border-dashed p-4 rounded-lg">
            No se encontraron pagos de comisiones para el período seleccionado.
        </div>
    } @else if (reports.length > 0) {
        <div [id]="reportContainerId" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-inner">
            @for (report of reports; track report.paymentId) {
                <div class="bg-white dark:bg-gray-700 p-6 rounded-lg shadow-md border-l-4 border-blue-500">
                    <div class="flex justify-between items-start mb-4 border-b pb-3 border-gray-200 dark:border-gray-600">
                        <div>
                            <span class="text-xs font-medium uppercase tracking-wider text-gray-500 dark:text-gray-400">Monto Pagado</span>
                            <p class="text-3xl font-bold text-green-600 dark:text-green-400 mt-1 flex items-center">
                                <fa-icon [icon]="faMoneyBillWave" class="mr-2 text-2xl"></fa-icon>
                                ${{ report.amount | number: '1.2-2' }}
                            </p>
                        </div>
                        <div class="text-right">
                            <span class="text-sm font-semibold text-white px-3 py-1 rounded-full inline-flex items-center"
                                [class]="report.status === 'PAGADO' ? 'bg-green-500' : 'bg-yellow-500'">
                                <fa-icon [icon]="faCheckCircle" class="mr-1"></fa-icon>
                                {{ report.status }}
                            </span>
                        </div>
                    </div>
                    
                    <dl class="space-y-3 text-sm text-gray-700 dark:text-gray-300">
                        <div class="flex items-center">
                            <fa-icon [icon]="faUserTie" class="w-4 h-4 text-blue-500 mr-3"></fa-icon>
                            <dt class="font-bold text-gray-900 dark:text-white mr-2">Repartidor:</dt>
                            <dd>{{ report.user.firstname }} {{ report.user.lastname }}</dd>
                        </div>
                        
                        <div class="flex items-center">
                            <dt class="font-bold text-gray-900 dark:text-white mr-2">Ref. Pago:</dt>
                            <dd>{{ report.referenceCode }}</dd>
                        </div>
                        
                        <div class="flex items-center">
                            <fa-icon [icon]="faCreditCard" class="w-4 h-4 text-purple-500 mr-3"></fa-icon>
                            <dt class="font-bold text-gray-900 dark:text-white mr-2">Método:</dt>
                            <dd>{{ report.paymentMethod }}</dd>
                        </div>
                        
                        <div class="flex items-center">
                            <fa-icon [icon]="faCalendarDays" class="w-4 h-4 text-gray-500 mr-3"></fa-icon>
                            <dt class="font-bold text-gray-900 dark:text-white mr-2">Fecha Pago:</dt>
                            <dd>{{ report.paymentDate | date:'dd/MM/yyyy' }}</dd>
                        </div>

                        @if (report.comment) {
                            <div class="pt-2 border-t border-gray-100 dark:border-gray-600">
                                <dt class="font-bold text-gray-900 dark:text-white">Comentario:</dt>
                                <dd class="text-xs italic">{{ report.comment }}</dd>
                            </div>
                        }
                    </dl>
                </div>
            }
        </div>
    }
</div>